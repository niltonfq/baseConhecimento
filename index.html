<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Base de Conhecimento</title>

    <link rel="stylesheet" href="assets/bootstrap-3.3.7-dist/css/bootstrap.css">

</head>
<body>
<div class="container">
    <h1>Categorias</h1>
    <br>

    <div class="row">
        <hr>

        <div class="col-sm-4">
            <div id="treeview12" class=""></div>
        </div>
        <div class="col-sm-4">
            <h3>Tópico</h3>
            <div>
                <textarea name="html_topico" id="html_topico" cols="80" rows="3"></textarea>
            </div>
            <h3>Informação</h3>
            <div >
                <textarea name="html_informacao" id="html_informacao" cols="80" rows="3"></textarea>
            </div>
        </div>
    </div>
    <br/>
</div>
<script src="./assets/js/jquery-3.3.1.min.js"></script>
<script src="./assets/js/bootstrap-treeview.js"></script>
<script type="text/javascript">

    $(function () {


        function mostraDados(node){
            $('#html_topico').html( node.text );
            $.get("http://localhost:8080/api/informacoes/topico/"+node.id, function (data) {
                $('#html_informacao').html( data["data"][0].descricao );
            });
        }

        var json;

        $.get("http://localhost:8080/api/categorias", function (data) {
            montaTreeview(data);
        })
        .done(function () {
            var $tree = $('#treeview12').treeview({
                data: json,
                onNodeSelected: function(event, node) {
                    mostraDados(node);
                }
            });
        })
        .fail(function () {
            alert("error");
        });

        function montaTreeview(data) {
            json = '[';
            var i;
            for (i = 0; i < data["data"].length; i++) {
                json += '{"text": "' + data["data"][i].nome + '"';

                montaNodes(data["data"][i].itens);

                json += '}';
                if (i != data["data"].length - 1) {
                    json += ',';
                }
            }
            json += ']';
        };

        function montaNodes(data) {
            if (data) {
                if (data.length != 0) {

                    json += ',"nodes": [{';

                    var i;
                    for (i = 0; i < data.length; i++) {

                        json += '"text": "' + data[i].nome + '",';
                        json += '"id": "' + data[i].id + '"';

                        montaNodes(data[i].itens);
                        montaNodes(data[i].topicos);
                        if (i != data.length - 1) {
                            json += '},{';
                        }
                    }

                    json += '}]';
                }
            }
        }
    });


</script>
</body>
</html>